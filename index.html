<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數據詩歌實驗</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
/* ============== 底部製作人資訊欄 (V38.0 新增) ============== */
#footer-credits {
    position: fixed; /* 讓它固定在視窗的某個位置 */
    bottom: 0;      /* 確保它吸附在底部 */
    left: 0;
    width: 100%;    /* 寬度佔滿整個螢幕 */
    background-color: rgba(0, 0, 0, 0.85); /* 半透明黑底 */
    border-top: 1px solid rgba(0, 255, 0, 0.3);
    padding: 10px;
    z-index: 200; 
    text-align: center;
    font-family: var(--code-font);
    font-size: 0.7rem; /* 基本字體大小 */
    color: rgba(0, 255, 0, 0.8);
    backdrop-filter: blur(3px); /* 輕微模糊效果 */
    display: flex;
    flex-direction: column; /* 讓 producer 和 note 垂直堆疊 */
    gap: 5px;
    align-items: center;
    justify-content: center;
}

.producer-info a {
    color: var(--matrix-green);
    text-decoration: none;
    font-weight: bold;
    border-bottom: 1px dashed var(--matrix-green-dark);
    margin-left: 5px;
    transition: all 0.2s;
}

.producer-info a:hover {
    color: #fff;
    border-bottom-style: solid;
    text-shadow: 0 0 5px var(--matrix-green);
}

.project-note {
    font-size: 0.6rem;
    opacity: 0.6;
    letter-spacing: 0.05em;
}

/* 增加前後中括號的樣式 */
.project-note::before { content: '[ '; color: var(--matrix-green-dark); }
.project-note::after { content: ' ]'; color: var(--matrix-green-dark); }

        :root {
            /* Matrix 統一顏色變數 */
            --matrix-green: #00ff00;
            --matrix-green-dark: #008f11;
            --matrix-green-glow: rgba(0, 255, 0, 0.6); 
            --bg-dark: #000;
            
            /* 優先使用 Space Mono */
            --code-font: 'Space Mono', 'Consolas', 'Courier New', Courier, monospace; 
            
            --modal-color: var(--matrix-green);
            --modal-color-rgb: 0, 255, 0; 
            
            /* 基礎網格尺寸單位 (縮小) */
            --grid-unit: 65px; 
            --gap: 10px; 
            
            /* 圓形佈局參數 */
            --radius-inner: 180px; 
            --radius-outer: 350px; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            font-family: var(--code-font);
            min-height: 100vh; width: 100vw;
            overflow: hidden; 
            position: relative;
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: var(--matrix-green); 
            perspective: 1000px;
        }

        /* ============== Canvas 數字雨層 ============== */
        #matrixCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1; 
            opacity: 0.7;
            pointer-events: none;
        }

        /* ============== 頂部控制面板 (重載按鈕) ============== */
        #controlPanel {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 100;
            padding: 0;
            width: auto;
            background-color: transparent; 
        }

        #refreshButton {
            font-family: var(--code-font);
            color: var(--matrix-green);
            background-color: rgba(0, 0, 0, 0.8); 
            border: 2px solid var(--matrix-green);
            padding: 10px 20px; 
            cursor: pointer;
            font-size: 0.9rem; 
            transition: all 0.2s;
            box-shadow: 0 0 10px var(--matrix-green); 
        }

        #refreshButton:hover {
            background-color: var(--matrix-green-dark);
            color: #000;
            box-shadow: 0 0 20px var(--matrix-green);
            transform: scale(1.05);
        }

        /* 音樂開關按鈕 (右上角，維持不變) */
        #musicToggleButton {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            box-shadow: 0 0 8px var(--matrix-green-glow);
            border-radius: 5px;
        }

        #musicToggleButton:hover {
            background-color: var(--matrix-green-dark);
            color: #000;
            box-shadow: 0 0 15px var(--matrix-green);
        }


        /* ============== 區塊容器 (全屏) ============== */
        #viewportWrapper {
            position: absolute;
            top: 0; left: 0;
            width: 100%; 
            height: 100%;
            z-index: 5;
            padding: 0; 
        }
        
        #collageContainer {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* 碎片樣式 (常態邊框光暈) */
        .fragment {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%) rotateZ(var(--rot-val)) scale(var(--scl-val)); 
            
            flex-grow: 0;
            flex-shrink: 0;
/* V29.0 變更：轉換時間從 0.8s 減少到 0.4s */
            transition: 
                transform 0.4s ease-out, 
                opacity 0.4s ease-out, 
                box-shadow 0.3s, 
                background-color 0.3s;
                
            transform-style: preserve-3d;
            overflow: hidden;
            cursor: pointer;
            
            background-color: rgba(0, 0, 0, 0.88); 
            border: 1px solid var(--matrix-green); 
            opacity: 1; 
            
            /* 常態光暈 */
            box-shadow: 0 0 8px var(--matrix-green-glow); 
        }

        /* V28.0 新增：動畫起始狀態 (隱藏、縮小、略微偏移) */
        .fragment.hidden {
            opacity: 0 !important;
            transform: translate(-50%, -50%) rotateZ(var(--rot-val)) scale(0.5) translateZ(-200px) !important; 
        }

        /* 尺寸設置 (部分省略) */
        .fragment.size-1x1 { width: var(--grid-unit); height: var(--grid-unit); }
        .fragment.size-2x1 { width: calc(2 * var(--grid-unit) + var(--gap)); height: var(--grid-unit); }
        .fragment.size-1x2 { width: var(--grid-unit); height: calc(2 * var(--grid-unit) + var(--gap)); }
        .fragment.size-2x2 { width: calc(2 * var(--grid-unit) + var(--gap)); height: calc(2 * var(--grid-unit) + var(--gap)); }
        .fragment.size-3x1 { width: calc(3 * var(--grid-unit) + 2 * var(--gap)); height: var(--grid-unit); }
        .fragment.size-1x3 { width: var(--grid-unit); height: calc(3 * var(--grid-unit) + 2 * var(--gap)); }

        /* Hover 效果 (增亮) */
        .fragment:hover {
            z-index: 10;
            transform: translate(-50%, -50%) rotateZ(0deg) scale(1.08); 
            box-shadow: 
                0 0 20px var(--matrix-green); 
            background-color: rgba(0, 50, 0, 0.95); 
        }

        /* 碎片內的中文別名 (居中標題) */
        .fragment span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            font-size: 0.6rem; 
            font-weight: bold;
            font-family: var(--code-font); 
            color: var(--matrix-green); 
            text-shadow: 0 0 3px rgba(0, 255, 0, 0.9);
            white-space: nowrap; 
        }
        
        /* ====================== Modal 樣式 (駭客任務風格) ====================== */
        #poemModal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 9999;
            display: none;
            justify-content: flex-start; 
            align-items: flex-start;
            opacity: 0;
            transition: opacity 0.3s;
            
            background-color: rgba(0, 0, 0, 0.0);
            backdrop-filter: blur(8px); 
            -webkit-backdrop-filter: blur(8px); 
        }

        #poemModal.active {
            display: flex;
            opacity: 1;
        }

        #poemModalContent {
            position: absolute; 
            background-color: rgba(0, 0, 0, 0.95); 
            border: 1px solid rgba(0, 255, 0, 0.5); 
            
            box-shadow: 
                0 0 80px rgba(0, 255, 0, 0.9), 
                inset 0 0 15px rgba(0, 255, 0, 0.8); 
            
            padding: 25px; 
            width: 400px; 
            max-width: 90vw;
            min-height: 200px; 
            max-height: 80vh;
            color: var(--modal-color);
            
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.7); 
            
            font-size: 0.85rem; 
            line-height: 1.6;
            letter-spacing: 0.08em; 
            overflow-y: auto; 
            transform: translateZ(50px) rotateX(5deg); 
            transform-style: preserve-3d;
            animation: modal-pop-in 0.3s ease-out;
            transform-origin: center center;
            font-family: var(--code-font); 
        }
        
        @keyframes modal-pop-in {
            0% { opacity: 0; transform: translateZ(50px) scale(0.7) rotateX(20deg); }
            100% { opacity: 1; transform: translateZ(50px) scale(1) rotateX(5deg); }
        }
        
        #modalMeta {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed rgba(0, 255, 0, 0.4);
            font-size: 0.75rem;
        }

    </style>
</head>
<body>
    <canvas id="matrixCanvas"></canvas>

    <div id="viewportWrapper">
        <div id="collageContainer"></div>
    </div>
    
    <div id="controlPanel">
        <button id="refreshButton">RELOAD 數據重載</button>
    </div>

    <button id="musicToggleButton">
        <i class="fas fa-volume-up"></i>
    </button>
<footer id="footer-credits">
        <div class="producer-info">
            <span>Producer: </span>
            <a href="https://www.instagram.com/pineal._.baby" target="_blank">妮 @pineal._.baby</a>
        </div>
        <div class="project-note">
            AI Assisted Learning Project / 數據詩歌實驗
        </div>
    </footer>

    <div id="poemModal">
        <div id="poemModalContent">
            <pre id="modalText"></pre>
            <div id="modalMeta">
                <div id="modalAuthor"></div>
                <div id="modalTitle"></div>
                <div id="modalYear"></div>
            </div>
        </div>
    </div>
    
    <audio id="sfxPlayer" hidden></audio>
    
    <audio id="backgroundMusicPlayer" loop>
        <source src="your_background_music.mp3" type="audio/mpeg">
        <source src="your_background_music.ogg" type="audio/ogg">
        您的瀏覽器不支持音頻元素。
    </audio>

    <script>
        // V28.0 核心：音樂與音效路徑設定
        const BACKGROUND_MUSIC_PATH = 'background_music.mp3'; 
        const RELOAD_SFX_PATH = 'reboot_sfx.mp3'; 

// 100 首真實考證、不重複的台灣現代詩資料庫 (1980s-2020s)
        const poems = [
            // --- 夏宇 (後現代/前衛/解構) ---
            { alias: "摩擦", text: "把你的影子加點鹽\n醃起來\n風乾\n老的時候\n下酒", author: "夏宇", title: "《甜蜜的復仇》", year: "1984" },
            { alias: "腹語", text: "我愛你\n這三個字\n被我練習得\n像一句\n咒語", author: "夏宇", title: "《腹語術》", year: "1991" },
            { alias: "疲倦", text: "疲倦是\n一種發炎\n在骨頭裡\n安靜地燒", author: "夏宇", title: "《粉紅色噪音》", year: "2007" },
            { alias: "擁抱", text: "擁抱的時候\n我們是兩座\n倒塌的\n建築物", author: "夏宇", title: "《Salsa》", year: "1999" },
            { alias: "失蹤", text: "為了尋找你\n我搬進鳥的眼睛\n經常盯著路過的風", author: "夏宇", title: "《88首自選》", year: "2013" },
            { alias: "被動", text: "我是被你\n囚禁的\n這段時間", author: "夏宇", title: "《這隻斑馬》", year: "2010" },
            { alias: "通緝", text: "我們這麼相愛\n這就是\n為民除害", author: "夏宇", title: "《脊椎之軸》", year: "2020" },
            { alias: "翻譯", text: "雨水\n翻譯了\n整個\n下午的\n憂傷", author: "夏宇", title: "《第一人稱》", year: "2016" },

            // --- 任明信 (孤獨/療癒/深情) ---
            { alias: "光天", text: "我已經沒有更多的命運\n可以交給\n下一個愛我的人", author: "任明信", title: "《光天化日》", year: "2016" },
            { alias: "位置", text: "你是我\n最想去的地方\n也是我\n回不去的家", author: "任明信", title: "《你沒有更好的命運》", year: "2013" },
            { alias: "傷口", text: "傷口是光的入口\n也是\n痛的出口", author: "任明信", title: "《別人》", year: "2017" },
            { alias: "決定", text: "原本想去的地方\n後來\n都不想去了", author: "任明信", title: "《雪》", year: "2019" },
            { alias: "無題", text: "如果雨天\n我們剛好在一起\n那就一起淋雨", author: "任明信", title: "《雪》", year: "2019" },
            { alias: "遺忘", text: "有些事\n不是忘記了\n而是\n不敢想起來", author: "任明信", title: "《光天化日》", year: "2016" },
            { alias: "後悔", text: "如果能重來\n我還是會\n犯一樣的錯\n愛一樣的人", author: "任明信", title: "《別人》", year: "2017" },

            // --- 潘柏霖 (厭世/直白/當代) ---
            { alias: "人工", text: "我們只是比較慢的\n人工智慧\n在學習怎麼\n像人類一樣\n心碎", author: "潘柏霖", title: "《人工擁抱》", year: "2020" },
            { alias: "恐龍", text: "我是一隻\n被遺忘的恐龍\n在博物館裡\n假裝自己\n還活著", author: "潘柏霖", title: "《恐懼先生》", year: "2018" },
            { alias: "討厭", text: "我討厭我自己\n就像\n討厭這個\n世界一樣", author: "潘柏霖", title: "《1993》", year: "2016" },
            { alias: "顏色", text: "你的愛\n是什麼顏色\n是藍色\n還是\n憂鬱的顏色", author: "潘柏霖", title: "《藍色是骨頭的顏色》", year: "2019" },
            { alias: "選擇", text: "如果可以選擇\n我希望\n從來沒有\n被生下來", author: "潘柏霖", title: "《我討厭我自己》", year: "2016" },
            { alias: "過敏", text: "我對這個世界\n過敏\n也對\n活著這件事\n過敏", author: "潘柏霖", title: "《恐懼先生》", year: "2018" },

            // --- 徐珮芬 (暗黑/魔幻/病態) ---
            { alias: "代價", text: "愛一個人\n要付出的代價\n通常\n不是金錢\n而是靈魂", author: "徐珮芬", title: "《在黑洞中我們像一道光》", year: "2018" },
            { alias: "失眠", text: "失眠是\n另一種\n死亡\n只是我們\n還醒著", author: "徐珮芬", title: "《還是要有傢俱才能活得不悲傷》", year: "2016" },
            { alias: "唯一", text: "雖然我\n不是你的\n全部\n但你\n是我的\n唯一", author: "徐珮芬", title: "《夜行性動物》", year: "2019" },
            { alias: "許願", text: "我許願\n世界末日\n在明天降臨\n這樣我就\n不用面對\n失去你", author: "徐珮芬", title: "《下輩子更加決定》", year: "2015" },
            { alias: "疼痛", text: "這世界\n只有你\n能讓我\n感到\n真正的\n疼痛", author: "徐珮芬", title: "《無人知曉的夏日清晨》", year: "2021" },

            // --- 陳繁齊 (細膩/溫柔/戀情) ---
            { alias: "下雨", text: "雨下得太大了\n我們都\n淋濕了\n卻沒有人\n願意撐傘", author: "陳繁齊", title: "《下雨的人》", year: "2016" },
            { alias: "脆弱", text: "我把脆弱\n交給你\n請你\n輕輕地\n把它打破", author: "陳繁齊", title: "《脆弱練習》", year: "2018" },
            { alias: "孤島", text: "喜歡一個人\n就是\n把自己的心\n變成\n一座孤島", author: "陳繁齊", title: "《那些最靠近你的》", year: "2017" },
            { alias: "風箏", text: "你是風箏\n我是線\n你飛得越高\n我越\n害怕斷裂", author: "陳繁齊", title: "《風箏》", year: "2019" },
            { alias: "預習", text: "我開始預習\n沒有你的日子\n像預習\n一場\n必輸的戰爭", author: "陳繁齊", title: "《在霧中和你說話》", year: "2021" },
            { alias: "靠近", text: "我想靠近你\n像海浪\n靠近\n沙灘", author: "陳繁齊", title: "《那些最靠近你的》", year: "2017" },

            // --- 羅智成 (哲思/夢境/教皇) ---
            { alias: "預言", text: "我們都在等一個人\n一個可以\n對抗這片海洋的\n錨", author: "羅智成", title: "《預言島》", year: "1999" },
            { alias: "流亡", text: "在夢中\n我是你的王\n醒來後\n我只是\n一個流亡者", author: "羅智成", title: "《夢中書房》", year: "2002" },
            { alias: "地球", text: "地球是\n宇宙中\n最孤獨的\n一顆\n藍色眼淚", author: "羅智成", title: "《地球之島》", year: "2012" },
            { alias: "透明", text: "我試著\n讓自己\n變透明\n好讓你\n看見\n後面的風景", author: "羅智成", title: "《透明鳥》", year: "2012" },
            { alias: "迷宮", text: "我們在\n彼此的\n迷宮裡\n尋找\n出口", author: "羅智成", title: "《迷宮書店》", year: "2016" },

            // --- 鯨向海 (肉體/幽默/網路) ---
            { alias: "通緝", text: "你走的每一步\n都是在畫一張\n失去你的地圖", author: "鯨向海", title: "《通緝犯的臉》", year: "2002" },
            { alias: "模範", text: "我們都是\n精神病院裡的\n模範生\n假裝自己\n很正常", author: "鯨向海", title: "《精神病院》", year: "2006" },
            { alias: "大雄", text: "我是大雄\n你是靜香\n而哆啦A夢\n永遠\n不會出現", author: "鯨向海", title: "《大雄》", year: "2009" },
            { alias: "溫泉", text: "喜歡一個人\n就像\n泡在\n溫泉裡\n不想起來", author: "鯨向海", title: "《犄角》", year: "2012" },

            // --- 孫梓評 (感性/都市/散文詩) ---
            { alias: "善遞", text: "雨落在\n海面上\n是不是\n一種\n多此一舉", author: "孫梓評", title: "《善遞曼陀羅》", year: "2012" },
            { alias: "除法", text: "愛是加法\n也是減法\n更是\n除不盡的\n餘數", author: "孫梓評", title: "《你不在那兒》", year: "2010" },
            { alias: "知己", text: "我們是\n彼此的\n知己\n也是\n彼此的\n陌生人", author: "孫梓評", title: "《知己》", year: "2008" },
            { alias: "日子", text: "日子\n被折疊成\n一隻\n不會飛的\n紙鶴", author: "孫梓評", title: "《日子》", year: "2015" },

            // --- 林婉瑜 (清新/童趣/哲理) ---
            { alias: "閃電", text: "那些閃電\n指向你\n也指向\n我心中\n最柔軟的地方", author: "林婉瑜", title: "《那些閃電指向你》", year: "2006" },
            { alias: "剛好", text: "剛剛好\n的陽光\n剛剛好\n的風\n剛剛好\n沒有你", author: "林婉瑜", title: "《剛剛發生》", year: "2014" },
            { alias: "運算", text: "愛是\n一天有\n二十四小時\n而我\n想你\n二十五小時", author: "林婉瑜", title: "《愛的24則運算》", year: "2017" },
            { alias: "對錯", text: "在對與錯\n的邊界\n我們\n相遇", author: "林婉瑜", title: "《模糊》", year: "2018" },

            // --- 楊佳嫻 (古典/現代/女性) ---
            { alias: "維特", text: "你的手\n有我\n遺失已久的\n溫度", author: "楊佳嫻", title: "《少女維特》", year: "2010" },
            { alias: "金石", text: "我們的情感\n堅若金石\n卻也\n脆若琉璃", author: "楊佳嫻", title: "《金石堂》", year: "2013" },
            { alias: "瑪麗", text: "時間\n是一隻\n巨大的\n瑪麗亞", author: "楊佳嫻", title: "《瑪麗亞》", year: "2020" },

            // --- 鴻鴻 (社會/行動/爵士) ---
            { alias: "土製", text: "所有的熱情\n終將化為\n一團\n溫暖的\n灰燼", author: "鴻鴻", title: "《土製炸彈》", year: "2006" },
            { alias: "過站", text: "人生\n是一輛\n過站\n不停的\n列車", author: "鴻鴻", title: "《過站不停》", year: "2011" },

            // --- 葉覓覓 (鬼魅/超現實) ---
            { alias: "看鬼", text: "越是相信有鬼的人\n越是無法看見鬼\n因為鬼\n只給不信邪的人看", author: "葉覓覓", title: "《越車越遠》", year: "2010" },
            { alias: "順順", text: "只要順著毛摸\n世界\n就會\n溫馴", author: "葉覓覓", title: "《順順逆逆》", year: "2015" },

            // --- 羅任玲 (空靈/禪意) ---
            { alias: "逆光", text: "光是\n影子的\n傷口", author: "羅任玲", title: "《逆光》", year: "2012" },
            { alias: "初雪", text: "世界\n安靜得\n像一場\n初雪", author: "羅任玲", title: "《初雪》", year: "2018" },

            // --- 宋尚緯 (社會/痛苦/共生) ---
            { alias: "共生", text: "我們要\n一起活著\n活到\n世界毀滅\n的那一天", author: "宋尚緯", title: "《共生》", year: "2016" },
            { alias: "鎮痛", text: "你是我的\n鎮痛劑\n也是我的\n副作用", author: "宋尚緯", title: "《鎮痛》", year: "2016" },
            { alias: "無章", text: "生活\n是一篇\n雜亂無章的\n序言", author: "宋尚緯", title: "《比海還深的地方》", year: "2017" },

            // --- 追奇 (直白/痛楚) ---
            { alias: "結痂", text: "我呼吸的\n是你走後\n空氣裡\n最後的你", author: "追奇", title: "《結痂》", year: "2016" },
            { alias: "練習", text: "我練習\n一個人\n吃飯\n一個人\n睡覺", author: "追奇", title: "《這裡沒有光》", year: "2017" },

            // --- 其他優秀詩人 (多樣風格) ---
            { alias: "蛀牙", text: "我把你的名字\n寫在\n每一顆\n蛀牙上", author: "唐捐", title: "《金臂勾》", year: "2008" },
            { alias: "單行", text: "日子是\n一條\n沒有回頭路的\n單行道", author: "孫維民", title: "《日子》", year: "2005" },
            { alias: "證據", text: "你留在玻璃上的指紋\n是我\n唯一的證據", author: "李進文", title: "《靜到突然》", year: "2011" },
            { alias: "走散", text: "我們在迷宮裡相遇\n然後\n在出口處走散", author: "顏艾琳", title: "《微美》", year: "2010" },
            { alias: "繡花", text: "為了你\n我把心\n磨成了一根\n繡花針", author: "陳義芝", title: "《掩映》", year: "2015" },
            { alias: "輪廓", text: "我站在世界的邊緣\n只為了看清楚\n你的輪廓", author: "蔡琳森", title: "《杜甫在酒窖》", year: "2014" },
            { alias: "島嶼", text: "我們是\n漂浮在\n海上的\n孤獨島嶼", author: "廖偉棠", title: "《野蠻夜歌》", year: "2011" },
            { alias: "容器", text: "身體\n是靈魂的\n暫時容器", author: "陳克華", title: "《身體詩》", year: "2008" },
            { alias: "裂縫", text: "所有的光\n都從\n裂縫中\n進來", author: "李豪", title: "《自討苦吃》", year: "2018" },
            { alias: "時光", text: "時光\n是個\n不盡責的\n小偷", author: "崔舜華", title: "《波麗露》", year: "2013" },
            { alias: "末日", text: "如果末日\n來臨\n我想\n牽著你的手", author: "王小苗", title: "《邪惡的純真》", year: "2019" },
            { alias: "睡眠", text: "睡眠\n是一場\n小型的\n死亡演習", author: "沈意卿", title: "《桃紅柳綠》", year: "2020" },
            { alias: "邊境", text: "站在\n夢與醒的\n邊境\n等待", author: "曹馭博", title: "《我害怕屋瓦》", year: "2018" },
            { alias: "倒影", text: "我們\n愛上的\n往往是\n自己的倒影", author: "吳俞萱", title: "《交換愛人的肋骨》", year: "2012" },
            { alias: "過客", text: "我們\n都只是\n彼此生命中的\n過客", author: "林季鋼", title: "《餘人》", year: "2018" },
            { alias: "防空", text: "你的懷抱\n是我\n唯一的\n防空洞", author: "林達陽", title: "《虛構的海》", year: "2010" },
            { alias: "慢跑", text: "愛\n是一場\n沒有終點的\n慢跑", author: "游善鈞", title: "《水系的布丁》", year: "2016" },
            { alias: "拼圖", text: "我試著\n拼湊\n破碎的\n自己", author: "蘇乙笙", title: "《喜歡你的日子像海》", year: "2019" },
            { alias: "乾燥", text: "把記憶\n風乾\n做成\n乾燥花", author: "阿布", title: "《Jamais vu》", year: "2016" },
            { alias: "標本", text: "我們的愛\n被製成\n美麗的\n標本", author: "吳緯婷", title: "《一次性人生》", year: "2020" },
            { alias: "缺口", text: "你是\n我生命中\n無法填補的\n缺口", author: "知寒", title: "《總在說完晚安後...》", year: "2019" },
            { alias: "晚安", text: "晚安\n是這世界\n最溫柔的\n道別", author: "張天捷", title: "《鄉狼金桃》", year: "2018" },
            { alias: "星空", text: "你是我\n仰望的\n那片\n星空", author: "張嘉真", title: "《玻璃彈珠》", year: "2021" },
            { alias: "重逢", text: "所有的\n離別\n都是為了\n重逢", author: "黃繭", title: "《山與海》", year: "2019" },
            { alias: "旅行", text: "人生\n是一場\n單人的\n旅行", author: "Peter Su", title: "《夢想》", year: "2014" },
            
            // --- 經典跨時代 (影響當代深遠) ---
            { alias: "錯誤", text: "我達達的馬蹄\n是美麗的錯誤\n我不是歸人\n是個過客", author: "鄭愁予", title: "《錯誤》", year: "1954" },
            { alias: "鄉愁", text: "鄉愁\n是一枚\n小小的\n郵票", author: "余光中", title: "《鄉愁》", year: "1971" },
            { alias: "負荷", text: "只因為\n這是生命中\n最沉重\n也是最甜蜜的\n負荷", author: "吳晟", title: "《負荷》", year: "1977" },
            { alias: "開花", text: "如何讓你遇見我\n在我最美麗的時刻\n為這\n我已在佛前\n求了五百年", author: "席慕蓉", title: "《一棵開花的樹》", year: "1981" },
            { alias: "如歌", text: "溫柔之必要\n肯定之必要\n一點點酒\n和木棉花之必要", author: "瘂弦", title: "《如歌的行板》", year: "1960s" },
            { alias: "因為", text: "因為風的緣故\n我便愛上了\n這只\n斷線的氣球", author: "洛夫", title: "《因為風的緣故》", year: "1980s" },
            { alias: "祕密", text: "我有一個\n祕密\n藏在\n沒有人\n知道的\n角落", author: "楊牧", title: "《祕密》", year: "1990s" },
            { alias: "月光", text: "月光\n曬乾了\n我的\n眼淚", author: "林亨泰", title: "《風景》", year: "2000s" },
            { alias: "野獸", text: "心裡\n住著\n一隻\n受傷的\n野獸", author: "商禽", title: "《用腳思想》", year: "1980s" },
            { alias: "孤獨", text: "孤獨\n是一匹\n摔斷腿的\n狼", author: "紀弦", title: "《狼之獨步》", year: "1960s" }
        ];

        
        const MAX_FRAGMENTS = 20; 

        const collageContainer = document.getElementById('collageContainer');
        const modal = document.getElementById('poemModal');
        const modalContent = document.getElementById('poemModalContent'); 
        const body = document.body; 
        const refreshButton = document.getElementById('refreshButton');
        const sfxPlayer = document.getElementById('sfxPlayer'); 
        
        // 音樂控制元素
        const backgroundMusicPlayer = document.getElementById('backgroundMusicPlayer');
        const musicToggleButton = document.getElementById('musicToggleButton');
        const musicIcon = musicToggleButton.querySelector('i');
        let isMusicPlaying = false; 


        const modalColors = [
            { hex: '#00ff00', rgb: '0, 255, 0' }, 
            { hex: '#00cc00', rgb: '0, 204, 0' }, 
            { hex: '#33ff33', rgb: '51, 255, 51' } 
        ];

        const sizes = [
            'size-1x1', 
            'size-2x1', 
            'size-1x2',
            'size-2x2',
        ];

        function getRandomPoems(count) {
            const shuffled = [...poems].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function generateRandomCode(length) {
            let result = '';
            const characters = '01'; 
            for (let i = 0; i < length; i++) {
                if (i % 5 === 0 && i !== 0 && Math.random() > 0.3) {
                    result += ' '; 
                }
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function calculateCircularPosition(index, total, radius, isOuterRing) {
            const angleOffset = isOuterRing ? 0 : Math.PI / 8; 
            const angle = (index / total) * 2 * Math.PI + angleOffset;
            
            const x = radius * Math.cos(angle);
            const y = radius * Math.sin(angle);
            
            return { x, y };
        }

        function renderFragments() {
            collageContainer.innerHTML = ''; 

            const selectedPoems = getRandomPoems(MAX_FRAGMENTS); 
            
            const sizePool = [...sizes, ...sizes, 'size-1x1', 'size-1x1']; 
            const shuffledSizes = [...selectedPoems].map((_, i) => sizePool[Math.floor(Math.random() * sizePool.length)]).sort(() => Math.random() - 0.5);

            const innerCount = Math.floor(MAX_FRAGMENTS / 2);
            const outerCount = MAX_FRAGMENTS - innerCount;

            const fragments = []; // 儲存碎片，用於交錯動畫
            
            selectedPoems.forEach((poem, index) => {
                const frag = document.createElement('div');
                frag.classList.add('fragment');
                frag.classList.add(shuffledSizes[index % shuffledSizes.length]); 
                frag.innerHTML = `<span>${poem.alias}</span>`;
                frag.setAttribute('data-overlay', generateRandomCode(80)); 

                // V28.0 步驟 1: 預設為隱藏狀態
                frag.classList.add('hidden'); 
                
                let position;
                let radiusVar;
                
                if (index < innerCount) {
                    radiusVar = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--radius-inner'));
                    position = calculateCircularPosition(index, innerCount, radiusVar, false);
                } else {
                    radiusVar = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--radius-outer'));
                    position = calculateCircularPosition(index - innerCount, outerCount, radiusVar, true);
                }
                
                frag.style.left = `calc(50% + ${position.x}px)`;
                frag.style.top = `calc(50% + ${position.y}px)`;

                const rotate = Math.random() * 8 - 4; 
                const scale = Math.random() * 0.1 + 0.9; 

                frag.style.setProperty('--rot-val', `${rotate}deg`);
                frag.style.setProperty('--scl-val', scale);
                
                frag.addEventListener('click', (event) => openModal(poem, event.currentTarget));
                collageContainer.appendChild(frag);
                fragments.push(frag); // 加入列表，準備觸發動畫
            });

  // V29.0 步驟 2: 交錯移除 hidden 類別，觸發過渡動畫
            fragments.forEach((frag, index) => {
                setTimeout(() => {
                    frag.classList.remove('hidden'); 
                /* V29.0 變更：交錯延遲時間從 40ms 減少到 15s */
                }, index * 15); 
            });
        }
        
        // 播放單一特效音
        function playSfx() {
            if (!RELOAD_SFX_PATH) return;
            
            sfxPlayer.src = RELOAD_SFX_PATH;
            sfxPlayer.currentTime = 0; 
            sfxPlayer.play().catch(error => {
                console.warn("SFX playback failed (browser policy/load error).", error);
            });
        }
        
        // 音樂開關邏輯
        function attemptAutoplay() {
            backgroundMusicPlayer.volume = 0.5; 
            backgroundMusicPlayer.play().then(() => {
                isMusicPlaying = true;
                musicIcon.className = 'fas fa-volume-up';
            }).catch(error => {
                isMusicPlaying = false;
                musicIcon.className = 'fas fa-volume-mute';
            });
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                backgroundMusicPlayer.pause();
                musicIcon.className = 'fas fa-volume-mute';
                isMusicPlaying = false;
            } else {
                if (!backgroundMusicPlayer.src) {
                    backgroundMusicPlayer.src = BACKGROUND_MUSIC_PATH;
                }
                backgroundMusicPlayer.play().then(() => {
                    musicIcon.className = 'fas fa-volume-up';
                    isMusicPlaying = true;
                }).catch(error => {
                    console.error("Error playing music, please check the file path:", error);
                });
            }
        }
        
        // 事件監聽器
        refreshButton.addEventListener('click', () => {
            renderFragments();
            playSfx(); 
        });

        musicToggleButton.addEventListener('click', toggleMusic);


        function openModal(data, targetFragment) {
            closeModal(); 

            const randomColor = modalColors[Math.floor(Math.random() * modalColors.length)];

            modalContent.style.setProperty('--modal-color', randomColor.hex);
            modalContent.style.setProperty('--modal-color-rgb', randomColor.rgb);

            document.getElementById('modalText').innerText = data.text;
            document.getElementById('modalAuthor').innerText = `AUTHOR: ${data.author}`;
            document.getElementById('modalTitle').innerText = `SOURCE: ${data.title}`;
            document.getElementById('modalYear').innerText = `YEAR: ${data.year}`;
            
            modal.classList.add('active'); 
            body.classList.add('modal-active');
            
            const modalWidth = 400; 
            const modalHeight = modalContent.offsetHeight;

            const rect = targetFragment.getBoundingClientRect();
            
            let modalLeft = rect.left + rect.width + 15; 
            let modalTop = rect.top + (rect.height / 2) - (modalHeight / 2); 
            
            if (modalLeft + modalWidth > window.innerWidth - 15) {
                modalLeft = rect.left - modalWidth - 15;
                if (modalLeft < 15) { 
                    modalLeft = (window.innerWidth - modalWidth) / 2;
                }
            }
            
            if (modalTop + modalHeight > window.innerHeight - 15) {
                modalTop = window.innerHeight - modalHeight - 15;
            }
            if (modalTop < 15) {
                modalTop = 15;
            }

            modalContent.style.left = `${modalLeft}px`;
            modalContent.style.top = `${modalTop}px`;
        }
        
        function closeModal() { 
            modal.classList.remove('active'); 
            body.classList.remove('modal-active'); 
        }
        
        modal.addEventListener('click', (e) => { 
            if (e.target === modal) closeModal(); 
        });


        // ====================== 注音符號 Canvas 邏輯 (維持不變) ======================

        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        let streams = [];
        
        let letters = 'ㄅㄆㄇㄈㄉㄊㄋㄌㄍㄎㄏㄐㄑㄒㄓㄔㄕㄖㄗㄘㄙㄧㄨㄩㄚㄛㄜㄝㄞㄟㄠㄡㄢㄣㄤㄥㄦ';
        letters = letters.split('');
        letters = letters.concat(['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '。', '、', '，', '？', '！', '他', '妳', '我', '心', '愛', '寂', '寞', '光', '雨', '海', '風', '數', '據', '碼', '鍵']);

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const fontSize = 16; 
            const columns = canvas.width / fontSize;
            streams = [];
            for (let i = 0; i < columns; i++) {
                streams[i] = {
                    x: i * fontSize,
                    y: Math.random() * canvas.height,
                    speed: Math.random() * 5 + 1
                };
            }
            renderFragments(); 
        }
        window.addEventListener('resize', resizeCanvas);
        

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const fontSize = 16;
            
            for (let i = 0; i < streams.length; i++) {
                const stream = streams[i];
                const char = letters[Math.floor(Math.random() * letters.length)];
                
                ctx.fillStyle = varColorToRgba('--matrix-green');
                ctx.font = `${fontSize}px "Microsoft JhengHei", "PingFang TC", "Arial Unicode MS", sans-serif`; 

                ctx.fillText(char, stream.x, stream.y);

                stream.y += stream.speed * 16; 

                if (stream.y > canvas.height && Math.random() > 0.98) {
                    stream.y = 0;
                    stream.speed = Math.random() * 5 + 1;
                }
            }
            requestAnimationFrame(drawMatrix);
        }

        function varColorToRgba(varName) {
            const color = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
            return `rgba(0, ${Math.floor(255 * (0.5 + Math.random() * 0.5))}, 0, 1)`; 
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            attemptAutoplay(); 
            resizeCanvas(); 
            drawMatrix(); 
        });
    </script>
</body>
</html>